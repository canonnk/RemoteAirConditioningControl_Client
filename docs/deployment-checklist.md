# 部署检查清单

## 一键登录功能部署检查

### ✅ 云函数配置

- [ ] **uni-id配置**: 复制 `config.example.json` 为 `config.json` 并填入真实配置
- [ ] **univerify配置**: 填入正确的 appid、apiKey、apiSecret
- [ ] **短信服务配置**: 配置短信服务商信息和模板ID
- [ ] **密钥安全**: 确保所有密钥都已更改为生产环境密钥

### ✅ 云函数部署

- [ ] **one-click-login**: 部署一键登录云函数
- [ ] **send-sms**: 部署发送短信云函数  
- [ ] **verify-sms**: 部署验证短信云函数
- [ ] **check-token**: 部署token验证云函数
- [ ] **add-device**: 部署添加设备云函数

### ✅ 数据库初始化

- [ ] **用户表**: 创建 uni-id-users 集合
- [ ] **短信表**: 创建 sms_codes 集合
- [ ] **日志表**: 创建 login_logs 集合
- [ ] **设备表**: 创建 user_devices 集合
- [ ] **索引**: 为所有表创建必要的索引

### ✅ 应用配置

- [ ] **manifest.json**: 配置 univerify 权限
- [ ] **包名配置**: 在DCloud开发者中心配置正确的包名/Bundle ID
- [ ] **证书配置**: 上传正确的签名证书

### ✅ 服务开通

- [ ] **univerify服务**: 在DCloud开发者中心开通一键登录服务
- [ ] **短信服务**: 开通并配置短信服务商
- [ ] **模板审核**: 确保短信模板已审核通过

### ✅ 测试验证

- [ ] **真机测试**: 在真机上测试一键登录功能
- [ ] **短信测试**: 测试短信验证码发送和验证
- [ ] **错误处理**: 测试各种异常情况的处理
- [ ] **用户体验**: 确保登录流程顺畅

## 配置文件示例

### manifest.json 配置

```json
{
  "app-plus": {
    "oauth": {
      "univerify": {
        "description": "一键登录"
      }
    },
    "distribute": {
      "android": {
        "packagename": "your.package.name"
      },
      "ios": {
        "appid": "your.bundle.id"
      }
    }
  }
}
```

### uni-id 配置要点

```json
{
  "service": {
    "univerify": {
      "appid": "必须与DCloud开发者中心一致",
      "apiKey": "从DCloud开发者中心获取", 
      "apiSecret": "从DCloud开发者中心获取"
    },
    "sms": {
      "name": "短信服务商名称",
      "smsKey": "短信服务商提供的Key",
      "smsSecret": "短信服务商提供的Secret"
    }
  }
}
```

## 常见问题排查

### 一键登录问题

1. **提示"未开通服务"**
   - 检查是否在DCloud开发者中心开通univerify服务
   - 确认应用包名与开发者中心配置一致

2. **预登录失败**
   - 检查网络连接
   - 确认配置信息正确
   - 在真机上测试（模拟器不支持）

3. **获取手机号失败**
   - 检查云函数中的配置是否正确
   - 查看云函数日志排查具体错误

### 短信验证码问题

1. **收不到短信**
   - 检查短信服务商配置
   - 确认短信模板已审核通过
   - 检查手机号格式是否正确

2. **验证码错误**
   - 检查验证码是否过期
   - 确认输入的验证码正确
   - 查看数据库中的验证码记录

## 安全建议

- [ ] **密钥管理**: 使用环境变量或配置中心管理敏感信息
- [ ] **频率限制**: 对短信发送和登录尝试进行频率限制  
- [ ] **日志记录**: 记录关键操作日志，便于问题排查
- [ ] **数据加密**: 对敏感数据进行加密存储
- [ ] **权限控制**: 实施严格的API访问权限控制

## 监控建议

- [ ] **成功率监控**: 监控一键登录和短信登录的成功率
- [ ] **错误日志**: 收集和分析错误日志
- [ ] **性能监控**: 监控登录接口的响应时间
- [ ] **用户反馈**: 建立用户反馈渠道

完成以上检查后，你的一键登录功能就可以正式上线了！