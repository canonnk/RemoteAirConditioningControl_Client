# 手机号登录示例项目

这是一个基于uni-app和uniCloud的手机号登录示例项目，支持短信验证码登录和一键登录功能。

## 功能特性

- ✅ 手机号短信验证码登录
- ✅ 一键登录（需要运营商支持）
- ✅ 登录状态管理
- ✅ 页面访问权限控制
- ✅ 自动登录状态检查
- ✅ 用户信息管理
- ✅ 全局主题切换（浅色/深色模式）
- ✅ 完整的设置界面
- ✅ 主题状态持久化存储
- ✅ **智能设备管理系统**
- ✅ **类米家风格的设备首页**
- ✅ **多种设备类型支持**
- ✅ **设备控制和状态监控**
- ✅ **添加设备功能**

## 项目结构

```
├── pages/                    # 页面目录
│   ├── devices/             # 设备首页（类米家风格）
│   ├── login/               # 登录页面
│   ├── index/               # 原首页
│   ├── me/                  # 个人中心
│   ├── settings/            # 设置页面
│   ├── add-device/          # 添加设备页面
│   ├── device-light/        # 智能灯具控制页面
│   ├── device-ac/           # 空调设备控制页面
│   ├── device-environment/  # 环境监测页面
│   └── device-detail/       # 通用设备详情页面
├── utils/                   # 工具类
│   ├── auth.js             # 认证工具类
│   └── theme.js            # 主题管理工具类
├── uniCloud-aliyun/        # uniCloud配置
│   ├── cloudfunctions/     # 云函数
│   │   ├── send-sms/       # 发送短信验证码
│   │   ├── verify-sms/     # 验证短信验证码
│   │   ├── one-click-login/# 一键登录
│   │   └── check-token/    # 验证token
│   └── database/           # 数据库初始化
└── App.vue                 # 应用入口
```

## 快速开始

### 1. 环境准备

- 安装HBuilderX
- 开通uniCloud服务
- 配置阿里云或腾讯云服务空间

### 2. 项目配置

1. 在HBuilderX中打开项目
2. 右键点击`uniCloud-aliyun`目录，选择"关联云服务空间"
3. 选择或创建云服务空间

### 3. 数据库初始化

1. 在uniCloud web控制台中，导入`uniCloud-aliyun/database/db_init.json`文件
2. 创建`users`和`sms_codes`集合

### 4. 云函数部署

1. 右键点击每个云函数目录，选择"上传并运行"
2. 确保所有云函数部署成功

### 5. 短信服务配置（可选）

如需真实发送短信，需要：
1. 在云服务商控制台开通短信服务
2. 修改`send-sms`云函数，集成短信服务API
3. 配置短信模板和签名

## 主要文件说明

### 云函数

#### send-sms
- 功能：发送短信验证码
- 参数：`{ phone: "手机号" }`
- 返回：验证码发送结果

#### verify-sms
- 功能：验证短信验证码并登录
- 参数：`{ phone: "手机号", code: "验证码" }`
- 返回：登录结果和token

#### one-click-login
- 功能：一键登录
- 参数：`{ access_token: "token", openid: "openid" }`
- 返回：登录结果和token

#### check-token
- 功能：验证token有效性
- 参数：`{ token: "用户token" }`
- 返回：用户信息

### 工具类

#### utils/auth.js
提供完整的认证功能：
- 登录状态检查
- Token管理
- 用户信息管理
- 页面访问权限控制

#### utils/theme.js
提供完整的主题管理功能：
- 主题切换（浅色/深色）
- 主题状态持久化
- 全局主题事件通知
- 状态栏和导航栏样式适配

## 使用说明

### 登录流程

1. **验证码登录**：
   - 输入手机号
   - 点击"发送验证码"
   - 输入收到的验证码
   - 点击"验证码登录"

2. **一键登录**：
   - 点击"一键登录"按钮
   - 系统自动获取手机号并登录

### 权限控制

- 所有页面（除登录页）都需要登录后才能访问
- 未登录用户会自动跳转到登录页
- Token过期会提示重新登录

### 用户信息

- 登录成功后，用户信息存储在本地
- 包含手机号、用户ID、登录时间等
- 可在个人中心查看详细信息

### 主题切换

- 支持浅色和深色两种主题模式
- 可在设置页面或首页快速切换
- 主题设置会自动保存并在下次启动时生效
- 所有页面都支持主题切换，包括状态栏和导航栏

### 设置功能

- 完整的设置界面，包含外观、账户、通用和关于等分类
- 主题模式切换开关
- 个人信息查看和管理
- 缓存清理和版本检查
- 隐私政策和用户协议查看

### 智能设备管理

- **设备首页**：类米家风格的卡片布局，直观展示所有设备
- **设备分类**：支持多种设备类型（照明、空调、安防、娱乐等）
- **设备控制**：
  - 智能灯具：开关控制、亮度调节、色温调节、颜色选择
  - 空调设备：温度控制、模式切换、风速调节、定时功能
  - 环境监测：实时显示温湿度、空气质量、PM2.5等数据
- **添加设备**：
  - 扫码添加：通过二维码快速添加设备
  - 自动发现：自动搜索局域网内的智能设备
  - 手动添加：通过IP地址或设备ID手动添加
  - 设备分类：按照设备类型分类展示
- **设备管理**：
  - 设备信息查看和编辑
  - 设备分享功能
  - 使用统计和历史记录
  - 设备移除和重置

## 开发注意事项

### 安全性

1. **生产环境配置**：
   - 移除调试代码中的验证码显示
   - 配置真实的短信服务
   - 使用更安全的token生成算法

2. **数据验证**：
   - 所有用户输入都需要验证
   - 手机号格式检查
   - 验证码有效期控制

3. **错误处理**：
   - 完善的错误提示
   - 网络异常处理
   - 用户体验优化

### 扩展功能

可以基于此项目扩展：
- 微信登录
- 密码登录
- 找回密码
- 用户资料完善
- 多端同步
- 更多主题颜色选择
- 字体大小调节
- 语言切换
- 消息推送设置
- **设备功能扩展**：
  - 场景模式（如回家模式、睡眠模式等）
  - 设备联动和自动化
  - 语音控制集成
  - 设备群组管理
  - 定时任务和计划
  - 设备状态监控和告警
  - 能耗统计和分析
  - 固件升级管理

## 常见问题

### Q: 验证码收不到？
A: 检查短信服务配置，确认手机号格式正确，查看云函数日志。

### Q: 一键登录失败？
A: 确认运营商支持，检查应用配置，查看错误日志。

### Q: 登录后立即退出？
A: 检查token验证逻辑，确认云函数正常运行。

### Q: 主题切换不生效？
A: 检查主题工具类是否正确导入，确认页面是否监听了主题变化事件。

### Q: 深色模式下部分元素显示异常？
A: 检查CSS样式是否完整添加了深色主题的适配样式。

## 技术支持

如有问题，请查看：
1. uniCloud官方文档
2. uni-app官方文档
3. 项目issue页面

## 许可证

MIT License